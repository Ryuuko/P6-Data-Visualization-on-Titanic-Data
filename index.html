<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <link href="css/animate.css" rel="stylesheet"/>
    <link href="css/waypoints.css" rel="stylesheet"/>
    <script src="js/jquery.waypoints.min.js" type="text/javascript"></script>
    <script src="js/waypoints.js" type="text/javascript"></script>
    <style type="text/css">



    button {
        border: none;
        border-radius: 3px;
        background-color: #2196F3;
        box-shadow: 2px 2px 10px 0px rgba(0, 0, 0, 0.33);
        margin-right: 10px;
        padding: 3px 10px;

    }


    p {
        position:absolute;
        top: 220px;
        left: 1100px;
    }
 
    .animated.fadeIn.title {
        position:absolute;
        top: 220px;
        left: 485px;
        display: table;
        text-align: center;
        display: table-cell;
        vertical-align: middle;
        max-width: none;

    }

    .animated.fadeIn.storybutton{
        position:absolute;
        top: 350px;
        left: 1180px;
        margin: auto; 

    }  

    .animated.fadeIn.explore1{
        position:absolute;
        top: 280px;
        left: 1181px;
    }

    .animated.fadeIn.explore2{
        position:absolute;
        top: 330px;
        left: 1190px;
    }
    .animated.fadeIn.explore3{
        position:absolute;
        top: 380px;
        left: 1180px;
    }




</style>
</head>
<body>
    <div class="animated fadeIn title", id="cover">
        <h1>"Women and children first"</h1>

        <h4 id="text1">The rescue principle in sinking of RMS Titanic<br><br></h4>

        <button id="next0-btn">Next</button>
    </div>
    <div id="container">
<!--         <section class="os-animation" data-os-animation="fadeIn" data-os-animation-delay="3s", id="animation"> -->
        <section, id="intro">
            <button class="animated fadeIn storybutton", style="display: none", id="next-btn">Next</button>
            <p class="animated fadeIn", style="display: none", id="text2"><br>Among the passengers on Titanic, the number of males was always larger than
    the number of females in every age category.</p>
            <p class="animated fadeIn", style="display: none", id="text3"><br><br>But there were always more females<br>being rescued.</p>
            <p class="animated fadeIn", style="display: none", id="text4"><br><br>Still, male children were more likely to survive comparing to other males.</p>
        </section>

    </div>

    <div style="display: none", id="Explore">
            <button class="animated fadeIn explore1", id="Total-btn">Total Number</button>
            <button class="animated fadeIn explore2", id="Survivors-btn">Survivors</button>
            <button class="animated fadeIn explore3", id="Survival_rate-btn">Survival Rate</button>
    </div>


    <script type="text/javascript">


        var margin = 75,
        width = 1200 - margin,
        height = 600 - margin;
        
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", width + margin)
                    .attr("height", height + margin)
                    .append('g')
                    .attr('class','chart');

        d3.select('#next0-btn').on('click', function() {
                // trigger the remove function
                var cover = document.getElementById('cover')
                cover.style.display = "none" 
                updateChart('Total') 
        }) 
        
        d3.select('#Total-btn').on('click', function(){
                updateChart('Total');
        })

        d3.select('#Survivors-btn').on('click', function(){
                updateChart('Survivors');
        })
        
        d3.select('#Survival_rate-btn').on('click', function(){
                updateChart('Survival_rate');
        })

        function updateChart(yAxis) {
        // 每次清除 svg 画布
            svg.selectAll('*').remove();


            d3.csv("MyData.csv", function(data) {

            var myChart = new dimple.chart(svg, data);
            myChart.setBounds(70, 60, 1000, 500);
            var x = myChart.addCategoryAxis("x", ["Age_group", "Sex"]);

            x.addOrderRule(["Children (0-14 years)",
                             "Youth (15-24 years)",
                             "Adults (25-59 years)",
                             "Seniors (60 years and over)"]);
            x.title = " Age Categories";
            x.addGroupOrderRule(["male", "female"])
            var y = myChart.addMeasureAxis("y", yAxis);

            if (yAxis === "Total") {
                y.title = "Number of Passengers";
                if (document.getElementById('intro') != null){

                    var text1 = document.getElementById('text1') ;
                    text1.style.display = "none" //not to display the first text
                    var text2 = document.getElementById('text2') ;
                    text2.style.display = "initial" // back to the normal display

                    var intro = document.getElementById('next-btn')
                    intro.style.display = "initial" 
                    d3.select('#next-btn').on('click', function() {
                            // this.style.display = "none"; //not to display the first button
                            updateChart('Survivors')
                            }) 
                }


            } else if (yAxis === "Survivors") {


                y.title = "Number of Survivors";
                    if (document.getElementById('intro') != null) {  

                        var text2 = document.getElementById('text2') ;
                        text2.style.display = "none" //not to display the first text
                        var text3 = document.getElementById('text3') ;
                        text3.style.display = "initial" 

                        d3.select('#next-btn').on('click', function() { 
                                updateChart('Survival_rate');
                                })}

            } else if (yAxis === "Survival_rate") {

                y.title = "Percentage of Survivors";
                y.tickFormat = "%";
                if (document.getElementById('intro') != null) {
                    
                    var text3 = document.getElementById('text3') ;
                    text3.style.display = "none" //not to display the first text
                    var text4 = document.getElementById('text4') ;
                    text4.style.display = "initial" 

                    document.getElementById('next-btn').innerHTML  = "Explore";

                    d3.select('#next-btn').on('click', function() {
                        var text4 = document.getElementById('text4') ;
                        text4.style.display = "none"
                        var elem = document.getElementById('intro');
                        elem.parentNode.removeChild(elem);//remove all the previous buttons and text

                        updateChart('Total'); //initialization

                        var elem = document.getElementById("Explore");
                        elem.style.display = "initial" 

                            })
                    }
                }                       


            s = myChart.addSeries("Sex", dimple.plot.bar);
            s.addOrderRule("Sex")
            myChart.addLegend(580, 22, 510, 20, "right");
            myChart.draw(800);
            });
        } 
  </script>
</body>

</html>